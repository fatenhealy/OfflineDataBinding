<!DOCTYPE html>
<html>
    <head>
        <title></title>
        <meta charset="utf-8" />
        <link href="kendo/styles/kendo.mobile.all.min.css" rel="stylesheet" />

        <script src="cordova.js"></script>
        <script src="kendo/js/jquery.min.js"></script>
        <script src="kendo/js/kendo.mobile.min.js"></script>

    </head>
    <body>

        <div data-role="view" data-init="ProductsOffline">
            <ul id="Products-offline-listview"></ul>
        </div>

        <script>
            var app = new kendo.mobile.Application(document.body);
        
            function ProductsOffline() {
                //offline method 1
                /* var ProductsData = [
                {"ProductId": 1, "ProductName": "Orange"},
                {"ProductId": 2, "ProductName": "Apple"},
                {"ProductId": 3, "ProductName": "Cherries"},
                {"ProductId": 4, "ProductName": "Bananas"}
                ];
                var OfflineDataSource = new kendo.data.DataSource({data: ProductsData});
                $("#Products-offline-listview").kendoMobileListView({ dataSource: OfflineDataSource, template : $("#products-template").html()}); */
                //offline method 2 
                /*var OfflineDataSource = new kendo.data.DataSource({
                transport: {
                read: {
                url: "data/Products.json",
                dataType: "json"
                }
                }
                });
                $("#Products-offline-listview").kendoMobileListView({ dataSource: OfflineDataSource, template : $("#products-template").html()});*/ 
                //offline method 3
                var app = {};
                app.db = null;
                app.openDb = function() {
                    if (window.navigator.simulator === true) 
                        app.db = window.openDatabase("Northwind", "1.0", "Offline Demo", 200000);
                    else 
                        app.db = window.sqlitePlugin.openDatabase("Northwind");
                }
                app.createTable = function() {
                    var db = app.db;
                    db.transaction(function(tx) {
                        tx.executeSql("CREATE TABLE IF NOT EXISTS Products(ProductId INTEGER PRIMARY KEY ASC, ProductName TEXT)", []);
                    });
                }
                app.addProduct = function(ProductName) {
                    var db = app.db;
                    db.transaction(function(tx) {
                        tx.executeSql("INSERT INTO Products(ProductName) VALUES (?)",
                                      [ProductName],
                                      app.onSuccess,
                                      app.onError);
                    });
                }
                app.onSuccess = function(tx, r) {
                    console.log("Success");
                }
                app.onError = function(tx, e) {
                    console.log("error");
                } 
                var OfflineDataSource = new kendo.data.DataSource({
                                                                      transport: {
                        read: function(options) {
                            app.openDb();
                            app.createTable();
                            app.addProduct("Chocolate");
                            app.addProduct("Pasta");
                            app.addProduct("Rice");
                            var db = app.db;
                            db.transaction(function(tx) {
                                tx.executeSql('SELECT ProductName FROM Products', [],
                                              function(tx, results) {
                                                  var data = [];
                                                  var len = results.rows.length;
                                                  for (var i = 0; i < len; ++i) {
                                                      var obj = results.rows.item(i);
                                                      data[i] = obj;
                                                  }
                                                  options.success(data);
                                              },
                                              function(tx, error) {
                                                  console.log("selectProducts error");
                                              }
                                    );
                            });
                        }
                    }
                                                                  });
                $("#Products-offline-listview").kendoMobileListView({ dataSource: OfflineDataSource, template : $("#products-template").html()}); 
            }
            
            
            
        </script>

        <script type="text/x-kendo-template" id="products-template">
            
            #: ProductName #
            
        </script>
    </body>
</html>
            